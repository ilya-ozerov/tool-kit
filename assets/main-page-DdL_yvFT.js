import{j as s,a as x,r as u,b as k,h as v,d as D,c as g,e as U,L as E}from"./index-DsxbtHvp.js";import{G as $,p as C,C as h}from"./github-service-D7r81gGt.js";const I="_button_1eebr_1",B="_primary_1eebr_15",P={button:I,primary:B},f=e=>{const{className:t,variant:o="regular",...r}=e;return s.jsx("button",{className:x(P.button,o==="primary"&&P.primary,t),...r})},F="_paginator_7tob9_1",w="_selected_7tob9_6",N={paginator:F,selected:w},L=({currentPage:e,pageSize:t,totalItemsCount:o,onChangePage:r,className:i=""})=>{const c=Math.ceil(o/t),n=c<10?c:10,a=[];for(let l=1;l<=n;l++)a.push(l);const p=a.map(l=>s.jsx(f,{className:x(l===e&&N.selected),onClick:()=>r(l),children:l},l)),_=a.length>0&&e>1,j=a.length>0&&e<n;return s.jsxs("div",{className:x(N.paginator,i),"data-testid":"paginator",children:[_&&s.jsx(f,{onClick:()=>r(e-1),variant:"primary",children:"prev"}),s.jsx("div",{className:N.pages,children:p}),j&&s.jsx(f,{onClick:()=>r(e+1),variant:"primary",children:"next"})]})},z="_input_15ar2_1",G="_label_15ar2_15",S={input:z,label:G},M=e=>{const{className:t,label:o="",...r}=e,i=u.useId();return s.jsxs("div",{className:x(S.input,t),children:[o&&s.jsx("label",{htmlFor:i,className:S.label,children:o}),s.jsx("input",{id:i,...r})]})},V="_main_section_cta8t_1",q="_list_container_cta8t_9",A="_list_cta8t_9",H="_paginator_cta8t_31",y={main_section:V,list_container:q,list:A,paginator:H},b=k(async({skip:e})=>$.getCurrentUserRepos(e)),m=k(async({query:e,skip:t})=>$.getRepositories(e,t)),T=v([]).on(m.doneData,(e,t)=>t.data.result.repositories);T.on(b.doneData,(e,t)=>t.data.result.repositories.repositories);const J=m.pending,K=b.pending;v({endCursor:"",hasNextPage:!1,hasPreviousPage:!1,startCursor:""}).on(m.doneData,(e,t)=>t.data.result.pageInfo);const Q=v(0).on(m.doneData,(e,t)=>t.data.result.repositoryCount);Q.on(b.doneData,(e,t)=>t.data.result.repositories.repositoryCount);const O=({query:e,onChangeQuery:t,className:o=""})=>{const[r,i]=u.useState(e);u.useEffect(()=>{i(e)},[e]);const c=u.useRef();return u.useEffect(()=>()=>{clearTimeout(c.current)},[]),s.jsx(M,{"data-testid":"search-field",value:r,onChange:n=>{clearTimeout(c.current),i(n.target.value),c.current=setTimeout(()=>{t(n.target.value)},1e3)},className:o})},W=()=>{const[e,t]=D(),o=Number(e.get("page"))||1,r=u.useCallback(n=>{t(a=>(a.set("page",String(n)),a))},[t]),i=e.get("searchQuery")||"",c=u.useCallback(n=>{t(a=>(r(1),a.set("searchQuery",n),a))},[r,t]);return{pageNumber:o,setPageNumber:r,searchQuery:i,setSearchQuery:c}},Z=()=>{const e=g(b),t=g(m),o=g(T),r=g(J),i=g(K),c=g(Q),n=r||i,{pageNumber:a,searchQuery:p,setPageNumber:_,setSearchQuery:j}=W();u.useEffect(()=>{p.length===0&&e({skip:(a-1)*C}),p.length>0&&t({query:p,skip:(a-1)*C})},[e,t,a,p,_]);const l=o.map(d=>{var R;return s.jsxs("li",{children:[s.jsx(h,{label:"Name",value:d.repository.name,type:"link",linkTarget:"_self",linkTo:`${U.card}/${d.repository.owner.login}/${d.repository.name}`}),s.jsx(h,{label:"Stars",value:String(d.repository.stargazerCount)}),s.jsx(h,{label:"Last commit",type:"date",value:((R=d.repository.defaultBranchRef)==null?void 0:R.target.history.nodes[0].committedDate)||""}),s.jsx(h,{label:"Url",type:"link",value:d.repository.url})]},d.repository.id)});return s.jsxs("section",{className:y.main_section,children:[s.jsx(O,{query:p,onChangeQuery:j}),s.jsx(L,{className:y.paginator,currentPage:a,pageSize:C,onChangePage:_,totalItemsCount:c}),s.jsxs("div",{className:y.list_container,children:[n&&s.jsx(E,{}),!n&&s.jsx("ul",{className:y.list,children:l})]})]})};export{Z as default};
