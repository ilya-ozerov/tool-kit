import{b as x,h as f,r as c,j as t,I as v,a as k,c as l,C as m,d as T,P as Q,L as $}from"./index-P6UkT1Jm.js";import{G as R,p as y}from"./github-service-BYxvs9GU.js";const D="_main_section_cta8t_1",U="_list_container_cta8t_9",E="_list_cta8t_9",I="_paginator_cta8t_31",h={main_section:D,list_container:U,list:E,paginator:I},_=x(async({skip:s})=>R.getCurrentUserRepos(s)),d=x(async({query:s,skip:e})=>R.getRepositories(s,e)),j=f([]).on(d.doneData,(s,e)=>e.data.result.repositories);j.on(_.doneData,(s,e)=>e.data.result.repositories.repositories);const F=d.pending,L=_.pending;f({endCursor:"",hasNextPage:!1,hasPreviousPage:!1,startCursor:""}).on(d.doneData,(s,e)=>e.data.result.pageInfo);const b=f(0).on(d.doneData,(s,e)=>e.data.result.repositoryCount);b.on(_.doneData,(s,e)=>e.data.result.repositories.repositoryCount);const z=({query:s,onChangeQuery:e,className:p=""})=>{const[o,u]=c.useState(s);c.useEffect(()=>{u(s)},[s]);const n=c.useRef();return c.useEffect(()=>()=>{clearTimeout(n.current)},[]),t.jsx(v,{"data-testid":"search-field",value:o,onChange:a=>{clearTimeout(n.current),u(a.target.value),n.current=setTimeout(()=>{e(a.target.value)},1e3)},className:p})},G=()=>{const[s,e]=k(),p=Number(s.get("page"))||1,o=c.useCallback(a=>{e(r=>(r.set("page",String(a)),r))},[e]),u=s.get("searchQuery")||"",n=c.useCallback(a=>{e(r=>(o(1),r.set("searchQuery",a),r))},[o,e]);return{pageNumber:p,setPageNumber:o,searchQuery:u,setSearchQuery:n}},B=()=>{const s=l(_),e=l(d),p=l(j),o=l(F),u=l(L),n=l(b),a=o||u,{pageNumber:r,searchQuery:g,setPageNumber:C,setSearchQuery:S}=G();c.useEffect(()=>{g.length===0&&s({skip:(r-1)*y}),g.length>0&&e({query:g,skip:(r-1)*y})},[s,e,r,g,C]);const N=p.map(i=>{var P;return t.jsxs("li",{children:[t.jsx(m,{label:"Name",value:i.repository.name,type:"link",linkTarget:"_self",linkTo:`${T.card}/${i.repository.owner.login}/${i.repository.name}`}),t.jsx(m,{label:"Stars",value:String(i.repository.stargazerCount)}),t.jsx(m,{label:"Last commit",type:"date",value:((P=i.repository.defaultBranchRef)==null?void 0:P.target.history.nodes[0].committedDate)||""}),t.jsx(m,{label:"Url",type:"link",value:i.repository.url})]},i.repository.id)});return t.jsxs("section",{className:h.main_section,children:[t.jsx(z,{query:g,onChangeQuery:S}),t.jsx(Q,{className:h.paginator,currentPage:r,pageSize:y,onChangePage:C,totalItemsCount:n}),t.jsxs("div",{className:h.list_container,children:[a&&t.jsx($,{}),!a&&t.jsx("ul",{className:h.list,children:N})]})]})};export{B as default};
